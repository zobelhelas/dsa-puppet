##
## THIS FILE IS UNDER PUPPET CONTROL. DON'T EDIT IT HERE.
## USE: git clone git+ssh://$USER@puppet.debian.org/srv/puppet.debian.org/git/dsa-puppet.git
##

@def &SERVICE($proto, $port) = {
 proto $proto mod state state (NEW) dport $port ACCEPT;
}

@def &SERVICE_RANGE($proto, $port, $srange) = {
 proto $proto mod state state (NEW) dport $port @subchain "$port" { saddr ($srange) ACCEPT; }"
}

@def &TCP_UDP_SERVICE($port) = {
 proto (tcp udp) dport $port ACCEPT;
}

@def &TCP_UDP_SERVICE_RANGE($port, $srange) = {
 proto (tcp udp) dport $port @subchain "$port" { saddr ($srange) ACCEPT; }"
}

@def $HOST_MAILRELAY_V4 = (<%=
  mailrelay = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['mailrelay']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /:/
             mailrelay << ip
          end
      end
  end

  mailrelay.join(' ')
%>);

@def $HOST_MAILRELAY_V6 = (<%=
  mailrelay = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['mailrelay']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /\./
             mailrelay << ip
          end
      end
  end

  mailrelay.join(' ')
%>);

@def $HOST_MAILRELAY = ( $HOST_MAILRELAY_V4 $HOST_MAILRELAY_V6 );

@def $HOST_NAGIOS_V4 = (<%=
  nagii = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['nagiosmaster'] or scope.lookupvar('site::localinfo')[node]['extranrpeclient']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /:/
             nagii << ip
          end
      end
  end

  nagii.join(' ')
%>);

@def $HOST_NAGIOS_V6 = (<%=
  nagii = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['nagiosmaster'] or scope.lookupvar('site::localinfo')[node]['extranrpeclient']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /\./
             nagii << ip
          end
      end
  end

  nagii.join(' ')
%>);

@def $HOST_NAGIOS = ( $HOST_NAGIOS_V4 $HOST_NAGIOS_V6 );

@def $HOST_MUNIN_V4 = (<%=
  munins = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['muninmaster']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /:/
             munins << ip
          end
      end
  end

  munins.join(' ')
%>);

@def $HOST_MUNIN_V6 = (<%=
  munins = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['muninmaster']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /\./
             munins << ip
          end
      end
  end

  munins.join(' ')
%>);

@def $HOST_MUNIN = ( $HOST_MUNIN_V4 $HOST_MUNIN_V6 );

@def $HOST_DB_V6  = (<%=
  dbs = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['dbmaster']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /\./
             dbs << ip
          end
      end
  end

  dbs.join(' ')
%>);

@def $HOST_DB_V4 = (<%=
  dbs = []
  scope.lookupvar('site::localinfo').keys.sort.each do |node|
      if scope.lookupvar('site::localinfo')[node]['dbmaster']
          scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
             next if ip =~ /:/
             dbs << ip
          end
      end
  end

  dbs.join(' ')
%>);

@def $HOST_DB = ($HOST_DB_V4 $HOST_DB_V6);

@def $HOST_DEBIAN_V4 = (<%=
  dbs = []
  scope.lookupvar('site::allnodeinfo').keys.sort.each do |node|
      next unless scope.lookupvar('site::allnodeinfo')[node].has_key?('ipHostNumber')
      scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
         next if ip =~ /:/
         dbs << ip
      end
  end

  dbs.join(' ')
%>);

@def $HOST_DEBIAN_V6  = (<%=
  dbs = []
  scope.lookupvar('site::allnodeinfo').keys.sort.each do |node|
      next unless scope.lookupvar('site::allnodeinfo')[node].has_key?('ipHostNumber')
      scope.lookupvar('site::allnodeinfo')[node]['ipHostNumber'].each do |ip|
         next if ip =~ /\./
         dbs << ip
      end
  end

  dbs.join(' ')
%>);

@def $HOST_DEBIAN = ($HOST_DEBIAN_V4 $HOST_DEBIAN_V6);

@def $sgran   = (91.103.132.24/29 85.158.45.51/32);
@def $weasel  = ();
@def $weasel  = ($weasel 86.59.118.144/28); # debian@sil
@def $weasel  = ($weasel 86.59.21.32/29); # anguilla1
@def $weasel  = ($weasel 86.59.30.32/28); # anguilla2
@def $weasel  = ($weasel 141.201.27.0/24); # came
@def $weasel  = ($weasel 141.201.123.0/24); # cosy
@def $weasel  = ($weasel 62.99.152.176/28); # campus sbg
@def $zobel   = ();
@def $zobel   = ($zobel 87.139.82.80/32); # exit.credativ.com
@def $zobel   = ($zobel 87.193.134.192/27); # credativ qsc
@def $zobel   = ($zobel 78.47.2.104/29); # baldur, bragi, saga
@def $zobel   = ($zobel 92.198.42.24/29); # DG-i Office
@def $zobel   = ($zobel 93.94.128.0/21);  # DG-i AS
@def $zobel   = ($zobel 195.49.152.0/22); # DG-i AS
@def $zobel   = ($zobel 194.187.64.0/22); # DG-i AS
@def $luca    = (64.71.152.109);
@def $paravoid = (62.217.125.135); # scrooge.tty.gr
@def $tfheen   = ();
@def $tfheen   = ($tfheen 194.31.39.0/26); # office network
@def $tfheen   = ($tfheen 195.159.200.122); # home
@def $tfheen   = ($tfheen 77.40.254.120/29); # home
@def $master   = (82.195.75.110); # master.debian.org
@def $DSA_IPS = ($sgran $weasel $zobel $luca $paravoid $tfheen $master);

@def $sgran6     = (2001:4b10:100b::/48);
@def $sgran6     = ($sgran6 2001:4b10:0000:810b::/64);
@def $weasel6    = ();
@def $weasel6    = ($weasel6 2001:826:408::/48); # unisbg
@def $weasel6    = ($weasel6 2001:858:10f::/48); # anguilla
@def $zobel6     = ();
@def $zobel6     = ($zobel6 2001:6f8:1215::/48); # baldur
@def $zobel6     = ($zobel6 2001:6f8:928::/48); # WS2 
@def $zobel6     = ($zobel6 2a01:198:549::/48); # WGS20
@def $zobel6     = ($zobel6 2a01:198:6b2::/48); # AdS20
@def $zobel6     = ($zobel6 2a02:158::/32);     # DG-i AS
@def $luca6      = ();
@def $paravoid6  = (2001:648:2ffc:113:dcdb:eeff:fe5c:182b); # scrooge.tty.gr
@def $tfheen6    = ();
@def $tfheen6    = ($tfheen6 2a02:c0:1013:1::/64); # Office
@def $tfheen6    = ($tfheen6 2001:840:f000:4007::/64); # Home, link
@def $tfheen6    = ($tfheen6 2001:840:4007::/48); # Home
@def $master6     = (2001:41b8:202:deb:216:36ff:fe40:4001); # master.debian.org
@def $DSA_V6_IPS = ($sgran6 $weasel6 $zobel6 $luca6 $paravoid6 $tfheen6 $master6);

@def $USER_christoph = ();
#@def $USER_christoph = ($USER_christoph 212.114.250.148/31);
#@def $USER_christoph = ($USER_christoph 128.111.48.6/32); # U of Cal at Santa Barbara, until 2013-03
@def $USER_aurel32 = ();
@def $USER_aurel32 = ($USER_aurel32 88.191.126.93); # hall.aurel32.net
@def $USER_aurel32 = ($USER_aurel32 82.232.2.251); # farad.aurel32.net
@def $USER_joerg   = ();
@def $USER_joerg   = ($USER_joerg 213.146.108.160/29);
@def $USER_joerg   = ($USER_joerg 46.4.205.32);
@def $USER_joerg6  = ();
@def $USER_joerg6  = ($USER_joerg6 2a02:248:1005::/48);
@def $USER_joerg6  = ($USER_joerg6 2a01:4f8:131:1520::6667);

@def $BUILDD_SSH_ACCESS = ();
@def $BUILDD_SSH_ACCESS = ($BUILDD_SSH_ACCESS 194.177.211.200); # grieg
@def $BUILDD_SSH_ACCESS = ($BUILDD_SSH_ACCESS 97.107.116.29); # master
@def $BUILDD_SSH_ACCESS = ($BUILDD_SSH_ACCESS 206.12.19.5); # ravel
@def $BUILDD_SSH_ACCESS = ($BUILDD_SSH_ACCESS 82.195.75.110); # new-master
@def $FREEBSD_SSH_ACCESS = ();
@def $FREEBSD_SSH_ACCESS = ($FREEBSD_SSH_ACCESS $DSA_IPS $BUILDD_SSH_ACCESS);
@def $FREEBSD_SSH_ACCESS = ($FREEBSD_SSH_ACCESS $USER_christoph $USER_aurel32); # buildd admins
@def $UNGER_SSH_ACCESS = ();
@def $UNGER_SSH_ACCESS = ($UNGER_SSH_ACCESS $USER_joerg);
@def $UNGER_SSH6_ACCESS = ();
@def $UNGER_SSH6_ACCESS = ($UNGER_SSH6_ACCESS $USER_joerg6);
