
This device is for authorized users only.  All traffic on this device
is monitored and will be used as evidence for prosecutions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

<%=
def wrap(s, width=78)
      s.gsub(/(.{1,#{width}})(\s+|\Z)/, "\\1\n")
end

purp = ''
if nodeinfo.has_key?('nameinfo')
  purp += wrap(nodeinfo['nameinfo']) + "\n\n"
end

purp += 'Welcome to ' + fqdn
if (nodeinfo['ldap'].at(0)) and (nodeinfo['ldap'][0].has_key?('purpose'))
  if nodeinfo['ldap'][0]['purpose'].include?('buildd')
    purp += ", the Debian "
    if nodeinfo['ldap'][0].has_key?('architecture')
      purp += nodeinfo['ldap'][0]['architecture'][0]
    end
    purp += " build daemon\n"
  elsif nodeinfo['ldap'][0]['purpose'].include?('porterbox')
    purp += ", the Debian "
    if nodeinfo['ldap'][0].has_key?('architecture')
      purp += nodeinfo['ldap'][0]['architecture'][0]
    end
    purp += " porterbox\n"
  else
    purp += ", used for the following services:\n"
    nodeinfo['ldap'][0]['purpose'].sort.each do |l|
      if l =~ /\[\[(\*|-)?(.*?)\]\]/
        l = $2
      end
      if l =~ /\[\[(.*?)\|(.*?)\]\]/
        l = $2
      end
      purp += "\t" + l + "\n"
    end
  end
else
  purp += "\n"
end

if nodeinfo.has_key?('footer')
  purp += "\n" + nodeinfo['footer'] + "\n"
end
purp
-%>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

