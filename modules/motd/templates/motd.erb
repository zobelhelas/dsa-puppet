
This device is for authorized users only.  All traffic on this device
is monitored and will be used as evidence for prosecutions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

<%=
def wrap(s, width=78)
      s.gsub(/(.{1,#{width}})(\s+|\Z)/, "\\1\n")
end

purp = ''
if nodeinfo.has_key?('nameinfo')
  purp += wrap(nodeinfo['nameinfo']) + "\n\n"
end

purp += 'Welcome to ' + fqdn
if (nodeinfo['ldap'].has_key?('purpose'))
  if nodeinfo['ldap']['purpose'].include?('buildd')
    purp += ", the Debian "
    if nodeinfo['ldap'].has_key?('architecture')
      purp += nodeinfo['ldap']['architecture'][0]
    end
    purp += " build daemon\n"
  elsif nodeinfo['ldap']['purpose'].include?('porterbox')
    purp += ", the Debian "
    if nodeinfo['ldap'].has_key?('architecture')
      purp += nodeinfo['ldap']['architecture'][0]
    end
    purp += " porterbox\n"
    purp += "\n"
    purp += "See 'dchroot -l' for a list of available chroots.\n"
    if nodeinfo['ldap'].has_key?('admin')
      purp += "Please contact #{nodeinfo['ldap']['admin'][0]} for install requests,\n"
      purp += "following the recommendations in <URL:http://dsa.debian.org/doc/install-req/>.\n"
    end
  else
    purp += ", used for the following services:\n"
    nodeinfo['ldap']['purpose'].sort.each do |l|
      if l =~ /\[\[(\*|-)?(.*?)\]\]/
        l = $2
      end
      if l =~ /\[\[(.*?)\|(.*?)\]\]/
        l = $2
      end
      purp += "\t" + l + "\n"
    end
  end
else
  purp += "\n"
end

if (nodeinfo['ldap'].has_key?('physicalHost'))
  purp += "\nThis virtual server runs on the physical host #{nodeinfo['ldap']['physicalHost'][0]}.\n"
end

if nodeinfo.has_key?('footer')
  purp += "\n" + wrap(nodeinfo['footer']) + "\n"
end
purp
-%>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      By connecting to this maching you agree to abide to the Debian
        Machines Usage Policies (http://www.debian.org/devel/dmup)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

<%
# vim:set et:
# vim:set sts=2 ts=2:
# vim:set shiftwidth=2:
-%>
