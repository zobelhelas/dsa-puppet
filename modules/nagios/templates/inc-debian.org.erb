##
## THIS FILE IS UNDER PUPPET CONTROL. DON'T EDIT IT HERE.
## USE: git clone git+ssh://$USER@puppet.debian.org/srv/puppet.debian.org/git/dsa-puppet.git
##

<%=
nagii = []
localinfo.keys.sort.each do |node|
  if localinfo[node]['nagiosmaster'] or localinfo[node]['extranrpeclient']
    nagii << allnodeinfo[node]['ipHostNumber']
  end
end

case fqdn when
  'mundy.debian.org', 'penalosa.debian.org', 'caballero.debian.org', 'peri.debian.org' then
    nagii << '192.34.35.49'
end

out = "allowed_hosts=" + nagii.join(',')
out
%>


# the string "system-in-shutdown" is used by the remote side to tell
# if a system is running shutdown.  We do not use check_nrpe's
# exit code as that does not reliably tell us if the check could
# not connect to the nrpe server or if the remote check returned not-null.
command[dsa2_shutdown]=if /usr/lib/nagios/plugins/check_procs -w 1: -u root -C shutdown > /dev/null; then echo 'system-in-shutdown'; else echo 'no shutdown running' ; fi
