##
## THIS FILE IS UNDER PUPPET CONTROL. DON'T EDIT IT HERE.
## USE: git clone git+ssh://$USER@puppet.debian.org/srv/puppet.debian.org/git/dsa-puppet.git
##
## Format:
## domain: hostname[::port] options
## example:
## buildd.debian.org: raff.debian.org::587 byname

<%=
mxmatches = [ fqdn ]
routes = []
extraroutes = []

case fqdn
when 'spohr.debian.org', 'draghi.debian.org', 'merikanto.debian.org' then
  mxmatches << 'mailout.debian.org'
  extraroutes = [ "keyring.debian.org:\t\tkaufmann.debian.org" ]
end

mxregex = Regexp.new('^\d+\s+(.*)\.$')
mxinfo.keys.sort.each do |host|
  mxinfo[host][0]['mXRecord'].each do |mx|
    mxmatch = mxregex.match(mx)
    if mxmatches.include?(mxmatch[1])
      route = host + ":\t\t" + host
      if localinfo.has_key?(host) and localinfo[host].has_key?('mail_port') and localinfo[host]['mail_port'].to_s != ''
        route += "::" + localinfo[host]['mail_port'].to_s
      end
      routes << route
    end
  end
end

routes << extraroutes

routes.join("\n")
%>
