# puppet maintained

<Macro common-static-base $name>
	<IfModule mod_userdir.c>
		UserDir disabled
	</IfModule>
	ServerSignature On

	DocumentRoot /srv/static.debian.org/mirrors/$name/cur
	<Directory /srv/static.debian.org/mirrors/$name/cur>
		AllowOverride FileInfo Indexes Options=Multiviews
		IndexOptions FancyIndexing NameWidth=*
		Order allow,deny
		Allow from all
	</Directory>

	DefaultType text/plain
	AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
</Macro>


<Macro common-static-vhost-with-extra $name $extra>
	<Virtualhost <%= vhost_listen %> >
		ServerName $name
		ServerAdmin debian-admin@lists.debian.org

		ErrorLog /var/log/apache2/$name-error.log
		CustomLog /var/log/apache2/$name-access.log privacy

		Use common-static-base $name
		$extra
	</VirtualHost>
</Macro>

<Macro common-static-vhost-publiclog $name>
	<Virtualhost <%= vhost_listen %> >
		ServerName $name
		ServerAdmin debian-admin@lists.debian.org

		ErrorLog /var/log/apache2/$name-error.log
		CustomLog /var/log/apache2/$name-access.log privacy
		<IfModule mod_geoip.c>
			CustomLog /var/log/apache2/$name-public-access.log privacy+geo
		</IfModule>

		Use common-static-base $name
	</VirtualHost>
</Macro>

<Macro common-static-vhost $name>
	Use common-static-vhost-with-extra $name "# nada"
</Macro>


<Macro common-static-vhost-ssl $name>
	<VirtualHost <%= vhost_listen %> >
		ServerName $name
		ServerAdmin debian-admin@lists.debian.org

		CustomLog /var/log/apache2/$name-access.log privacy
		ErrorLog /var/log/apache2/$name-error.log

		Redirect permanent / https://$name/
	</VirtualHost>

	<Virtualhost <%= vhost_listen_443 %> >
		ServerName $name
		ServerAdmin debian-admin@lists.debian.org

		ErrorLog /var/log/apache2/$name-error.log
		CustomLog /var/log/apache2/$name-access.log privacyssl

		Use common-debian-service-ssl $name
		Use common-ssl-HSTS

		Use common-static-base $name
	</VirtualHost>
</Macro>

# vim:ft=apache:
